<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Twin API Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        
        .container {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #4ade80;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            background: #3a3a3a;
            border-radius: 8px;
            border-left: 4px solid #4ade80;
        }
        
        button {
            background: #4ade80;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #22c55e;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #6b7280;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 6px;
            border: 1px solid #4a5568;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        
        .success {
            border-color: #4ade80;
            background: #064e3b;
        }
        
        .error {
            border-color: #ef4444;
            background: #7f1d1d;
        }
        
        .info {
            background: #1e3a8a;
            border-color: #3b82f6;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .user-data {
            background: #4c1d95;
            border-color: #8b5cf6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Digital Twin API Demo</h1>
        
        <div class="info">
            <strong>üìã –î–µ–º–æ –æ–ø–∏—Å–∞–Ω–∏–µ:</strong><br>
            –≠—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É API –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –¥–≤–æ–π–Ω–∏–∫–∞. 
            –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        </div>
        
        <div class="demo-section">
            <h3>üîç –ê–Ω–∞–ª–∏–∑ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ –î–µ–º–æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (telegram_id: 987654321)</p>
            <button id="analyzeBtn" onclick="analyzeUserContext()">
                –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ö–æ–Ω—Ç–µ–∫—Å—Ç
            </button>
            <div id="analysisResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h3>üë§ –î–∞–Ω–Ω—ã–µ –î–µ–º–æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <button onclick="getUserData()">–ü–æ–ª—É—á–∏—Ç—å –î–∞–Ω–Ω—ã–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <div id="userResult" class="result user-data" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h3>üìä API Health Check</h3>
            <button onclick="checkApiHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –°—Ç–∞—Ç—É—Å API</button>
            <div id="healthResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        // –ú–æ–∫ Telegram initData –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        const MOCK_INIT_DATA = 'user=%7B%22id%22%3A987654321%2C%22first_name%22%3A%22Demo%22%2C%22last_name%22%3A%22User%22%2C%22username%22%3A%22demouser%22%7D&auth_date=1641234567&hash=mock_hash';
        
        async function analyzeUserContext() {
            const button = document.getElementById('analyzeBtn');
            const result = document.getElementById('analysisResult');
            
            button.disabled = true;
            button.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...';
            result.style.display = 'block';
            result.className = 'result';
            result.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞...';
            
            try {
                const response = await fetch(`${API_BASE}/api/users/me/analyze-context`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-Bot-Api-Secret-Token': 'demo'
                    },
                    body: JSON.stringify({ 
                        initDataRaw: MOCK_INIT_DATA,
                        userId: 'test-user-demo'
                    })
                });
                
                const data = await response.json();
                
                result.className = response.ok ? 'result success' : 'result error';
                result.textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                result.className = 'result error';
                result.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            } finally {
                button.disabled = false;
                button.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ö–æ–Ω—Ç–µ–∫—Å—Ç';
            }
        }
        
        async function getUserData() {
            const result = document.getElementById('userResult');
            result.style.display = 'block';
            result.textContent = '–ó–∞–≥—Ä—É–∂–∞—é –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...';
            
            try {
                // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
                const response = await fetch(`${API_BASE}/health`);
                const healthData = await response.json();
                
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∂–µ–º —á—Ç–æ –º—ã –∑–Ω–∞–µ–º –æ –Ω–∞—à–µ–º –¥–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const demoUserInfo = {
                    telegram_id: 987654321,
                    name: 'Demo User',
                    messages_count: 5,
                    sample_messages: [
                        'Wow! GPT-4 is absolutely amazing! The way it handles complex reasoning is just mind-blowing',
                        'I love how machine learning is revolutionizing everything from healthcare to finance',
                        'Neural networks are so fascinating! The way they learn patterns is incredible',
                        'Python is my favorite language for AI development especially with PyTorch and TensorFlow',
                        'Transformers architecture changed everything! Attention is all you need'
                    ],
                    expected_interests: ['AI', 'Machine Learning', 'Python', 'Neural Networks', 'Technology'],
                    expected_style: 'Enthusiastic, uses emojis, exclamation marks, technical vocabulary'
                };
                
                result.textContent = JSON.stringify(demoUserInfo, null, 2);
                
            } catch (error) {
                result.className = 'result error';
                result.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        async function checkApiHealth() {
            try {
                console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º API –∑–¥–æ—Ä–æ–≤—å–µ...');
                const response = await fetch(`${API_BASE}/health`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                showResult('healthResult', `‚úÖ API Health: ${data.status}`, 'success');
                
                // Automatically check user data if API is healthy
                if (data.status === 'healthy') {
                    await getUserData();
                }
                
            } catch (error) {
                console.error('API Health Check Error:', error);
                let errorMessage = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API: ';
                
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorMessage += 'CORS –∏–ª–∏ —Å–µ—Ç—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n';
                    errorMessage += '1. API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8000\n';
                    errorMessage += '2. CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n';
                    errorMessage += '3. –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞';
                } else {
                    errorMessage += error.message;
                }
                
                showResult('healthResult', errorMessage, 'error');
            }
        }
        
        function showResult(elementId, message, type) {
            const result = document.getElementById(elementId);
            result.style.display = 'block';
            result.className = `result ${type}`;
            result.textContent = message;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkApiHealth();
        };
    </script>
</body>
</html> 